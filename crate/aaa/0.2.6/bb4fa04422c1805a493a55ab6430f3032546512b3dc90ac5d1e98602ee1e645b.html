<!DOCTYPE html>
<html class=main>
<link rel=stylesheet href=gnatdoc.css><body class=content><h1>AAA.Filesystem</h1><h2>Entities</h2><h3>Tagged Types</h3><ul><li><a href=#5f9edc7d5c4e919adf2c8d763a45cb8f736020efd84d2975c4823dcc24219dfa>Replacer</a><li><a href=#c8ebb5a3a473f2d73806cbbb193c4f64a4fb1e42040ec35558f0b34d2b89182e>Temp_File</a></ul><h3>Subprograms</h3><ul><li><a href=#b30b36a8b383a5d2d4de6516faf97921efaf2f516cad2d172038c1b3a9cb76da>Backup_If_Existing</a><li><a href=#45f7b0c2f7c0a47051e3cf5e499add3d7994ac68cb2e2edd8058f20c0de95cfa>Editable_Name</a><li><a href=#eca1c603debfa25660b9a2dfc18ff50796e75ad5559afbbf01fa8961fd2a9e68>Filename</a><li><a href=#077dfcf121ad5fc341dd86aa66ac52dc28f870a53bc866a38f4d88f744c06b24>Is_File</a><li><a href=#550fb78cb08180f86c5723c48b140f1ac816deddc94cdb62e80d65f3e55ad871>Is_Folder</a><li><a href=#19f8b2881058d844215820a1f0298fde5d8e7091adad0ab7f9a7e4715204b257>Keep</a><li><a href=#fd418fd0420cd1f4f249afd8f57ebbc5125da4a7c30ecd7174f67d742119bca5>New_Name</a><li><a href=#2fcd1f67c45c66038159f40d3f392c2eb674ec7ceb2a3a9e61221401fb8e1857>New_Replacement</a><li><a href=#4492a7787c554286beffce50d38f4dc3a4d0dddb149e3941422501a5d6acd9d1>Remove_Folder_If_Empty</a><li><a href=#60ae34ed5a932e91ac4b51eb7b01e6ec29fe4bec47d37728c9efc46de278c54a>Replace</a><li><a href=#292a3819ccfe41cd7d62cb74bb949f8d34e2618607f1b1347466e692456baaf9>Traverse_Tree</a><li><a href=#93cecc81d41480e03db444229725919c6f7d96e72e81b9b67fcfb2dde6e10d1b>With_Name</a></ul><h2>Description</h2><h4 id=b30b36a8b383a5d2d4de6516faf97921efaf2f516cad2d172038c1b3a9cb76da>Backup_If_Existing</h4><pre class=ada-code-snippet><code>procedure Backup_If_Existing (File     : String;
                              Base_Dir : String := "")
</code></pre><p>If File exists, copy to file.prev. If Base_Dir /= "", it is instead copied to Base_Dir / Simple_Name (file) &amp; ".prev"<h5>Parameters</h5><dl><dt>File<dd><dt>Base_Dir<dd></dl><h4 id=45f7b0c2f7c0a47051e3cf5e499add3d7994ac68cb2e2edd8058f20c0de95cfa>Editable_Name</h4><pre class=ada-code-snippet><code>function Editable_Name (This : Replacer) return String
</code></pre><p>Obtain the editable copy full name<h5>Parameters</h5><dl><dt>This<dd></dl><h5>Return Value</h5><dl><dd></dl><h4 id=eca1c603debfa25660b9a2dfc18ff50796e75ad5559afbbf01fa8961fd2a9e68>Filename</h4><pre class=ada-code-snippet><code>function Filename (This : Temp_File) return String
</code></pre><p>The filename is a random sequence of 8 characters + ".tmp"<h5>Parameters</h5><dl><dt>This<dd></dl><h5>Return Value</h5><dl><dd></dl><h4 id=077dfcf121ad5fc341dd86aa66ac52dc28f870a53bc866a38f4d88f744c06b24>Is_File</h4><pre class=ada-code-snippet><code>function Is_File (Path : String) return Boolean
</code></pre><h5>Parameters</h5><dl><dt>Path<dd></dl><h5>Return Value</h5><dl><dd></dl><h4 id=550fb78cb08180f86c5723c48b140f1ac816deddc94cdb62e80d65f3e55ad871>Is_Folder</h4><pre class=ada-code-snippet><code>function Is_Folder (Path : String) return Boolean
</code></pre><h5>Parameters</h5><dl><dt>Path<dd></dl><h5>Return Value</h5><dl><dd></dl><h4 id=19f8b2881058d844215820a1f0298fde5d8e7091adad0ab7f9a7e4715204b257>Keep</h4><pre class=ada-code-snippet><code>procedure Keep (This : in out Temp_File)
</code></pre><p>If Keep is called, the file/dir will not be erased on finalization. This allows creating a temporary that will be deleted in case of failure but kept in case of success.<h5>Parameters</h5><dl><dt>This<dd></dl><h4 id=fd418fd0420cd1f4f249afd8f57ebbc5125da4a7c30ecd7174f67d742119bca5>New_Name</h4><pre class=ada-code-snippet><code>function New_Name (In_Folder : String := ".") return Temp_File
</code></pre><p>This finds a new random name; it does not create anything.<h5>Parameters</h5><dl><dt>In_Folder<dd></dl><h5>Return Value</h5><dl><dd></dl><h4 id=2fcd1f67c45c66038159f40d3f392c2eb674ec7ceb2a3a9e61221401fb8e1857>New_Replacement</h4><pre class=ada-code-snippet><code>function New_Replacement (File              : String;
                          Backup            : Boolean := True;
                          Backup_Dir        : String  := "";
                          Allow_No_Original : Boolean := False)
                          return Replacer
</code></pre><p>Receives a file to be modified, and prepares a copy in a temporary. If Backup, once the replacement is performed, the original file is kept as ".prev". Backup_Dir is used for this ".prev" file. When backup dir is empty, the containing directory of File is used. If Allow_No_Original is True, the function will not fail when File is not a path to an existing file.<h5>Parameters</h5><dl><dt>File<dd><dt>Backup<dd><dt>Backup_Dir<dd><dt>Allow_No_Original<dd></dl><h5>Return Value</h5><dl><dd></dl><h4 id=4492a7787c554286beffce50d38f4dc3a4d0dddb149e3941422501a5d6acd9d1>Remove_Folder_If_Empty</h4><pre class=ada-code-snippet><code>procedure Remove_Folder_If_Empty (Path : String)
</code></pre><p>Attempt to remove a folder, but do not complain if unable (because not empty or not existing).<h5>Parameters</h5><dl><dt>Path<dd></dl><h4 id=60ae34ed5a932e91ac4b51eb7b01e6ec29fe4bec47d37728c9efc46de278c54a>Replace</h4><pre class=ada-code-snippet><code>procedure Replace (This : in out Replacer)
</code></pre><p>Replace the original file with the edited copy. If this procedure is not called, on going out of scope the Replacer will remove the temporary and the original file remains untouched.<h5>Parameters</h5><dl><dt>This<dd></dl><h4 id=5f9edc7d5c4e919adf2c8d763a45cb8f736020efd84d2975c4823dcc24219dfa>Replacer</h4><pre class=ada-code-snippet><code>type Replacer (&lt;>) is tagged limited private;
</code></pre><p>A scoped type to ensure that a file is updated and replaced without trouble. In case of failure, the original file remains untouched. So what happens is: 1) A copy to a temp file is made. 2) This file is modified and can be tested as the client sees fit. 3) If the new file is proper, the old one is renamed to .prev and the new one takes its place.<h4 id=c8ebb5a3a473f2d73806cbbb193c4f64a4fb1e42040ec35558f0b34d2b89182e>Temp_File</h4><pre class=ada-code-snippet><code>type Temp_File (&lt;>) is tagged limited private;
</code></pre><p>A RAII scoped type to manage a temporary file name. Creates an instance with a unique file name. This does nothing on disk. The user is responsible for using the temp file name as they see fit. The file is deleted once an object of this type goes out of scope. If the file/folder was never created on disk nothing will happen.<h4 id=292a3819ccfe41cd7d62cb74bb949f8d34e2618607f1b1347466e692456baaf9>Traverse_Tree</h4><pre class=ada-code-snippet><code>procedure Traverse_Tree (Start   : String;
                         Doing   : access procedure
                           (Item : Ada.Directories.Directory_Entry_Type;
                            Stop : in out Boolean);
                         Recurse : Boolean := False)
</code></pre><h5>Parameters</h5><dl><dt>Start<dd><dt>Doing<dd><dt>Recurse<dd></dl><h4 id=93cecc81d41480e03db444229725919c6f7d96e72e81b9b67fcfb2dde6e10d1b>With_Name</h4><pre class=ada-code-snippet><code>function With_Name (Name : String) return Temp_File
</code></pre><p>Allows initializing the tmp file with a desired name.<h5>Parameters</h5><dl><dt>Name<dd></dl><h5>Return Value</h5><dl><dd></dl>